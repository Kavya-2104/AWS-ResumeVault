{"ast":null,"code":"import { ALGORITHM_QUERY_PARAM, SHA256_ALGORITHM_IDENTIFIER, CREDENTIAL_QUERY_PARAM, AMZ_DATE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, HOST_HEADER, EXPIRES_QUERY_PARAM, TOKEN_QUERY_PARAM, SIGNATURE_QUERY_PARAM } from './constants.mjs';\nimport { getSigningValues } from './utils/getSigningValues.mjs';\nimport { getSignature } from './utils/getSignature.mjs';\nimport { AmplifyUrl } from '../../../../../utils/amplifyUrl/index.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Given a `Presignable` object, returns a Signature Version 4 presigned `URL` object.\n *\n * @param presignable `Presignable` object containing at least a url to be presigned with authentication query params.\n * @param presignUrlOptions `PresignUrlOptions` object containing values used to construct the signature.\n * @returns A `URL` with authentication query params which can grant temporary access to AWS resources.\n */\nconst presignUrl = ({\n  body,\n  method = 'GET',\n  url\n}, {\n  expiration,\n  ...options\n}) => {\n  const signingValues = getSigningValues(options);\n  const {\n    accessKeyId,\n    credentialScope,\n    longDate,\n    sessionToken\n  } = signingValues;\n  // create the request to sign\n  // @ts-ignore URL constructor accepts a URL object\n  const presignedUrl = new AmplifyUrl(url);\n  Object.entries({\n    [ALGORITHM_QUERY_PARAM]: SHA256_ALGORITHM_IDENTIFIER,\n    [CREDENTIAL_QUERY_PARAM]: `${accessKeyId}/${credentialScope}`,\n    [AMZ_DATE_QUERY_PARAM]: longDate,\n    [SIGNED_HEADERS_QUERY_PARAM]: HOST_HEADER,\n    ...(expiration && {\n      [EXPIRES_QUERY_PARAM]: expiration.toString()\n    }),\n    ...(sessionToken && {\n      [TOKEN_QUERY_PARAM]: sessionToken\n    })\n  }).forEach(([key, value]) => {\n    presignedUrl.searchParams.append(key, value);\n  });\n  const requestToSign = {\n    body,\n    headers: {\n      [HOST_HEADER]: url.host\n    },\n    method,\n    url: presignedUrl\n  };\n  // calculate and add the signature to the url\n  const signature = getSignature(requestToSign, signingValues);\n  presignedUrl.searchParams.append(SIGNATURE_QUERY_PARAM, signature);\n  return presignedUrl;\n};\nexport { presignUrl };","map":{"version":3,"names":["presignUrl","body","method","url","expiration","options","signingValues","getSigningValues","accessKeyId","credentialScope","longDate","sessionToken","presignedUrl","AmplifyUrl","Object","entries","ALGORITHM_QUERY_PARAM","SHA256_ALGORITHM_IDENTIFIER","CREDENTIAL_QUERY_PARAM","AMZ_DATE_QUERY_PARAM","SIGNED_HEADERS_QUERY_PARAM","HOST_HEADER","EXPIRES_QUERY_PARAM","toString","TOKEN_QUERY_PARAM","forEach","key","value","searchParams","append","requestToSign","headers","host","signature","getSignature","SIGNATURE_QUERY_PARAM"],"sources":["E:\\CSC-PROJECT\\amplify-react-app\\node_modules\\@aws-amplify\\core\\src\\clients\\middleware\\signing\\signer\\signatureV4\\presignUrl.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { ALGORITHM_QUERY_PARAM, AMZ_DATE_QUERY_PARAM, CREDENTIAL_QUERY_PARAM, EXPIRES_QUERY_PARAM, HOST_HEADER, SHA256_ALGORITHM_IDENTIFIER, SIGNATURE_QUERY_PARAM, SIGNED_HEADERS_QUERY_PARAM, TOKEN_QUERY_PARAM, } from './constants';\nimport { getSigningValues } from './utils/getSigningValues';\nimport { getSignature } from './utils/getSignature';\nimport { AmplifyUrl } from '../../../../../utils/amplifyUrl';\n/**\n * Given a `Presignable` object, returns a Signature Version 4 presigned `URL` object.\n *\n * @param presignable `Presignable` object containing at least a url to be presigned with authentication query params.\n * @param presignUrlOptions `PresignUrlOptions` object containing values used to construct the signature.\n * @returns A `URL` with authentication query params which can grant temporary access to AWS resources.\n */\nexport const presignUrl = ({ body, method = 'GET', url }, { expiration, ...options }) => {\n    const signingValues = getSigningValues(options);\n    const { accessKeyId, credentialScope, longDate, sessionToken } = signingValues;\n    // create the request to sign\n    // @ts-ignore URL constructor accepts a URL object\n    const presignedUrl = new AmplifyUrl(url);\n    Object.entries({\n        [ALGORITHM_QUERY_PARAM]: SHA256_ALGORITHM_IDENTIFIER,\n        [CREDENTIAL_QUERY_PARAM]: `${accessKeyId}/${credentialScope}`,\n        [AMZ_DATE_QUERY_PARAM]: longDate,\n        [SIGNED_HEADERS_QUERY_PARAM]: HOST_HEADER,\n        ...(expiration && { [EXPIRES_QUERY_PARAM]: expiration.toString() }),\n        ...(sessionToken && { [TOKEN_QUERY_PARAM]: sessionToken }),\n    }).forEach(([key, value]) => {\n        presignedUrl.searchParams.append(key, value);\n    });\n    const requestToSign = {\n        body,\n        headers: { [HOST_HEADER]: url.host },\n        method,\n        url: presignedUrl,\n    };\n    // calculate and add the signature to the url\n    const signature = getSignature(requestToSign, signingValues);\n    presignedUrl.searchParams.append(SIGNATURE_QUERY_PARAM, signature);\n    return presignedUrl;\n};\n"],"mappings":";;;;;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACY,MAACA,UAAU,GAAGA,CAAC;EAAEC,IAAI;EAAEC,MAAM,GAAG,KAAK;EAAEC;AAAG,CAAE,EAAE;EAAEC,UAAU;EAAE,GAAGC;AAAO,CAAE,KAAK;EACrF,MAAMC,aAAa,GAAGC,gBAAgB,CAACF,OAAO,CAAC;EAC/C,MAAM;IAAEG,WAAW;IAAEC,eAAe;IAAEC,QAAQ;IAAEC;EAAY,CAAE,GAAGL,aAAa;EAClF;EACA;EACI,MAAMM,YAAY,GAAG,IAAIC,UAAU,CAACV,GAAG,CAAC;EACxCW,MAAM,CAACC,OAAO,CAAC;IACX,CAACC,qBAAqB,GAAGC,2BAA2B;IACpD,CAACC,sBAAsB,GAAI,GAAEV,WAAY,IAAGC,eAAgB,EAAC;IAC7D,CAACU,oBAAoB,GAAGT,QAAQ;IAChC,CAACU,0BAA0B,GAAGC,WAAW;IACzC,IAAIjB,UAAU,IAAI;MAAE,CAACkB,mBAAmB,GAAGlB,UAAU,CAACmB,QAAQ;IAAE,CAAE,CAAC;IACnE,IAAIZ,YAAY,IAAI;MAAE,CAACa,iBAAiB,GAAGb;IAAY,CAAE;EACjE,CAAK,CAAC,CAACc,OAAO,CAAC,CAAC,CAACC,GAAG,EAAEC,KAAK,CAAC,KAAK;IACzBf,YAAY,CAACgB,YAAY,CAACC,MAAM,CAACH,GAAG,EAAEC,KAAK,CAAC;EACpD,CAAK,CAAC;EACF,MAAMG,aAAa,GAAG;IAClB7B,IAAI;IACJ8B,OAAO,EAAE;MAAE,CAACV,WAAW,GAAGlB,GAAG,CAAC6B;IAAI,CAAE;IACpC9B,MAAM;IACNC,GAAG,EAAES;EACb,CAAK;EACL;EACI,MAAMqB,SAAS,GAAGC,YAAY,CAACJ,aAAa,EAAExB,aAAa,CAAC;EAC5DM,YAAY,CAACgB,YAAY,CAACC,MAAM,CAACM,qBAAqB,EAAEF,SAAS,CAAC;EAClE,OAAOrB,YAAY;AACvB"},"metadata":{},"sourceType":"module","externalDependencies":[]}