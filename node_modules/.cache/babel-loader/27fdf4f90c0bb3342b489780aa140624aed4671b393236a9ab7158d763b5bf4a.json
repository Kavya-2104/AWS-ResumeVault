{"ast":null,"code":"import { AuthValidationErrorCode } from '../../../errors/types/validation.mjs';\nimport { assertServiceError } from '../../../errors/utils/assertServiceError.mjs';\nimport { assertValidationError } from '../../../errors/utils/assertValidationError.mjs';\nimport { retryOnResourceNotFoundException, handleUserPasswordAuthFlow, getActiveSignInUsername, getNewDeviceMetatada, getSignInResult, getSignInResultFromError } from '../utils/signInHelpers.mjs';\nimport { Amplify, Hub } from '@aws-amplify/core';\nimport { assertTokenProviderConfig, AMPLIFY_SYMBOL } from '@aws-amplify/core/internals/utils';\nimport { setActiveSignInState, cleanActiveSignInState } from '../utils/signInStore.mjs';\nimport { cacheCognitoTokens } from '../tokenProvider/cacheTokens.mjs';\nimport '../utils/clients/CognitoIdentityProvider/index.mjs';\nimport '../../../errors/constants.mjs';\nimport '../tokenProvider/errorHelpers.mjs';\nimport { tokenOrchestrator } from '../tokenProvider/tokenProvider.mjs';\nimport { getCurrentUser } from './getCurrentUser.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Signs a user in using USER_PASSWORD_AUTH AuthFlowType\n *\n * @param input - The SignInWithUserPasswordInput object\n * @returns SignInWithUserPasswordOutput\n * @throws service: {@link InitiateAuthException } - Cognito service error thrown during the sign-in process.\n * @throws validation: {@link AuthValidationErrorCode  } - Validation errors thrown when either username or password\n *  are not defined.\n * @throws AuthTokenConfigException - Thrown when the token provider config is invalid.\n */\nasync function signInWithUserPassword(input) {\n  const {\n    username,\n    password,\n    options\n  } = input;\n  const authConfig = Amplify.getConfig().Auth?.Cognito;\n  const signInDetails = {\n    loginId: username,\n    authFlowType: 'USER_PASSWORD_AUTH'\n  };\n  assertTokenProviderConfig(authConfig);\n  const metadata = options?.clientMetadata;\n  assertValidationError(!!username, AuthValidationErrorCode.EmptySignInUsername);\n  assertValidationError(!!password, AuthValidationErrorCode.EmptySignInPassword);\n  try {\n    const {\n      ChallengeName,\n      ChallengeParameters,\n      AuthenticationResult,\n      Session\n    } = await retryOnResourceNotFoundException(handleUserPasswordAuthFlow, [username, password, metadata, authConfig, tokenOrchestrator], username, tokenOrchestrator);\n    const activeUsername = getActiveSignInUsername(username);\n    // sets up local state used during the sign-in process\n    setActiveSignInState({\n      signInSession: Session,\n      username: activeUsername,\n      challengeName: ChallengeName,\n      signInDetails\n    });\n    if (AuthenticationResult) {\n      await cacheCognitoTokens({\n        ...AuthenticationResult,\n        username: activeUsername,\n        NewDeviceMetadata: await getNewDeviceMetatada(authConfig.userPoolId, AuthenticationResult.NewDeviceMetadata, AuthenticationResult.AccessToken),\n        signInDetails\n      });\n      cleanActiveSignInState();\n      Hub.dispatch('auth', {\n        event: 'signedIn',\n        data: await getCurrentUser()\n      }, 'Auth', AMPLIFY_SYMBOL);\n      return {\n        isSignedIn: true,\n        nextStep: {\n          signInStep: 'DONE'\n        }\n      };\n    }\n    return getSignInResult({\n      challengeName: ChallengeName,\n      challengeParameters: ChallengeParameters\n    });\n  } catch (error) {\n    cleanActiveSignInState();\n    assertServiceError(error);\n    const result = getSignInResultFromError(error.name);\n    if (result) return result;\n    throw error;\n  }\n}\nexport { signInWithUserPassword };","map":{"version":3,"names":["signInWithUserPassword","input","username","password","options","authConfig","Amplify","getConfig","Auth","Cognito","signInDetails","loginId","authFlowType","assertTokenProviderConfig","metadata","clientMetadata","assertValidationError","AuthValidationErrorCode","EmptySignInUsername","EmptySignInPassword","ChallengeName","ChallengeParameters","AuthenticationResult","Session","retryOnResourceNotFoundException","handleUserPasswordAuthFlow","tokenOrchestrator","activeUsername","getActiveSignInUsername","setActiveSignInState","signInSession","challengeName","cacheCognitoTokens","NewDeviceMetadata","getNewDeviceMetatada","userPoolId","AccessToken","cleanActiveSignInState","Hub","dispatch","event","data","getCurrentUser","AMPLIFY_SYMBOL","isSignedIn","nextStep","signInStep","getSignInResult","challengeParameters","error","assertServiceError","result","getSignInResultFromError","name"],"sources":["E:\\CSC-PROJECT\\amplify-react-app\\node_modules\\@aws-amplify\\auth\\src\\providers\\cognito\\apis\\signInWithUserPassword.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { AuthValidationErrorCode } from '../../../errors/types/validation';\nimport { assertServiceError } from '../../../errors/utils/assertServiceError';\nimport { assertValidationError } from '../../../errors/utils/assertValidationError';\nimport { getActiveSignInUsername, getNewDeviceMetatada, getSignInResult, getSignInResultFromError, handleUserPasswordAuthFlow, retryOnResourceNotFoundException, } from '../utils/signInHelpers';\nimport { Amplify, Hub } from '@aws-amplify/core';\nimport { AMPLIFY_SYMBOL, assertTokenProviderConfig, } from '@aws-amplify/core/internals/utils';\nimport { cleanActiveSignInState, setActiveSignInState, } from '../utils/signInStore';\nimport { cacheCognitoTokens } from '../tokenProvider/cacheTokens';\nimport { tokenOrchestrator } from '../tokenProvider';\nimport { getCurrentUser } from './getCurrentUser';\n/**\n * Signs a user in using USER_PASSWORD_AUTH AuthFlowType\n *\n * @param input - The SignInWithUserPasswordInput object\n * @returns SignInWithUserPasswordOutput\n * @throws service: {@link InitiateAuthException } - Cognito service error thrown during the sign-in process.\n * @throws validation: {@link AuthValidationErrorCode  } - Validation errors thrown when either username or password\n *  are not defined.\n * @throws AuthTokenConfigException - Thrown when the token provider config is invalid.\n */\nexport async function signInWithUserPassword(input) {\n    const { username, password, options } = input;\n    const authConfig = Amplify.getConfig().Auth?.Cognito;\n    const signInDetails = {\n        loginId: username,\n        authFlowType: 'USER_PASSWORD_AUTH',\n    };\n    assertTokenProviderConfig(authConfig);\n    const metadata = options?.clientMetadata;\n    assertValidationError(!!username, AuthValidationErrorCode.EmptySignInUsername);\n    assertValidationError(!!password, AuthValidationErrorCode.EmptySignInPassword);\n    try {\n        const { ChallengeName, ChallengeParameters, AuthenticationResult, Session, } = await retryOnResourceNotFoundException(handleUserPasswordAuthFlow, [username, password, metadata, authConfig, tokenOrchestrator], username, tokenOrchestrator);\n        const activeUsername = getActiveSignInUsername(username);\n        // sets up local state used during the sign-in process\n        setActiveSignInState({\n            signInSession: Session,\n            username: activeUsername,\n            challengeName: ChallengeName,\n            signInDetails,\n        });\n        if (AuthenticationResult) {\n            await cacheCognitoTokens({\n                ...AuthenticationResult,\n                username: activeUsername,\n                NewDeviceMetadata: await getNewDeviceMetatada(authConfig.userPoolId, AuthenticationResult.NewDeviceMetadata, AuthenticationResult.AccessToken),\n                signInDetails,\n            });\n            cleanActiveSignInState();\n            Hub.dispatch('auth', {\n                event: 'signedIn',\n                data: await getCurrentUser(),\n            }, 'Auth', AMPLIFY_SYMBOL);\n            return {\n                isSignedIn: true,\n                nextStep: { signInStep: 'DONE' },\n            };\n        }\n        return getSignInResult({\n            challengeName: ChallengeName,\n            challengeParameters: ChallengeParameters,\n        });\n    }\n    catch (error) {\n        cleanActiveSignInState();\n        assertServiceError(error);\n        const result = getSignInResultFromError(error.name);\n        if (result)\n            return result;\n        throw error;\n    }\n}\n"],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAeA,sBAAsBA,CAACC,KAAK,EAAE;EAChD,MAAM;IAAEC,QAAQ;IAAEC,QAAQ;IAAEC;EAAO,CAAE,GAAGH,KAAK;EAC7C,MAAMI,UAAU,GAAGC,OAAO,CAACC,SAAS,EAAE,CAACC,IAAI,EAAEC,OAAO;EACpD,MAAMC,aAAa,GAAG;IAClBC,OAAO,EAAET,QAAQ;IACjBU,YAAY,EAAE;EACtB,CAAK;EACDC,yBAAyB,CAACR,UAAU,CAAC;EACrC,MAAMS,QAAQ,GAAGV,OAAO,EAAEW,cAAc;EACxCC,qBAAqB,CAAC,CAAC,CAACd,QAAQ,EAAEe,uBAAuB,CAACC,mBAAmB,CAAC;EAC9EF,qBAAqB,CAAC,CAAC,CAACb,QAAQ,EAAEc,uBAAuB,CAACE,mBAAmB,CAAC;EAC9E,IAAI;IACA,MAAM;MAAEC,aAAa;MAAEC,mBAAmB;MAAEC,oBAAoB;MAAEC;IAAO,CAAG,GAAG,MAAMC,gCAAgC,CAACC,0BAA0B,EAAE,CAACvB,QAAQ,EAAEC,QAAQ,EAAEW,QAAQ,EAAET,UAAU,EAAEqB,iBAAiB,CAAC,EAAExB,QAAQ,EAAEwB,iBAAiB,CAAC;IAC7O,MAAMC,cAAc,GAAGC,uBAAuB,CAAC1B,QAAQ,CAAC;IAChE;IACQ2B,oBAAoB,CAAC;MACjBC,aAAa,EAAEP,OAAO;MACtBrB,QAAQ,EAAEyB,cAAc;MACxBI,aAAa,EAAEX,aAAa;MAC5BV;IACZ,CAAS,CAAC;IACF,IAAIY,oBAAoB,EAAE;MACtB,MAAMU,kBAAkB,CAAC;QACrB,GAAGV,oBAAoB;QACvBpB,QAAQ,EAAEyB,cAAc;QACxBM,iBAAiB,EAAE,MAAMC,oBAAoB,CAAC7B,UAAU,CAAC8B,UAAU,EAAEb,oBAAoB,CAACW,iBAAiB,EAAEX,oBAAoB,CAACc,WAAW,CAAC;QAC9I1B;MAChB,CAAa,CAAC;MACF2B,sBAAsB,EAAE;MACxBC,GAAG,CAACC,QAAQ,CAAC,MAAM,EAAE;QACjBC,KAAK,EAAE,UAAU;QACjBC,IAAI,EAAE,MAAMC,cAAc;MAC1C,CAAa,EAAE,MAAM,EAAEC,cAAc,CAAC;MAC1B,OAAO;QACHC,UAAU,EAAE,IAAI;QAChBC,QAAQ,EAAE;UAAEC,UAAU,EAAE;QAAM;MAC9C,CAAa;IACb;IACQ,OAAOC,eAAe,CAAC;MACnBhB,aAAa,EAAEX,aAAa;MAC5B4B,mBAAmB,EAAE3B;IACjC,CAAS,CAAC;EACV,CAAK,CACD,OAAO4B,KAAK,EAAE;IACVZ,sBAAsB,EAAE;IACxBa,kBAAkB,CAACD,KAAK,CAAC;IACzB,MAAME,MAAM,GAAGC,wBAAwB,CAACH,KAAK,CAACI,IAAI,CAAC;IACnD,IAAIF,MAAM,EACN,OAAOA,MAAM;IACjB,MAAMF,KAAK;EACnB;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}