{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Drop-in replacement for fast-xml-parser's XmlParser class used in the AWS SDK S3 client XML deserializer. This\n * implementation is not tested against the full xml conformance test suite. It is only tested against the XML responses\n * from S3. This implementation requires the `DOMParser` class in the runtime.\n */\nconst parser = {\n  parse: xmlStr => {\n    const domParser = new DOMParser();\n    const xml = domParser.parseFromString(xmlStr, 'text/xml');\n    const parsedObj = parseXmlNode(xml);\n    const rootKey = Object.keys(parsedObj)[0];\n    return parsedObj[rootKey];\n  }\n};\nconst parseXmlNode = node => {\n  if (isDocumentNode(node)) {\n    return {\n      [node.documentElement.nodeName]: parseXmlNode(node.documentElement)\n    };\n  }\n  if (node.nodeType === Node.TEXT_NODE) {\n    return node.nodeValue?.trim();\n  }\n  if (isElementNode(node)) {\n    // Node like <Location>foo</Location> will be converted to { Location: 'foo' }\n    // instead of { Location: { '#text': 'foo' } }.\n    if (isTextOnlyElementNode(node)) {\n      return node.childNodes[0]?.nodeValue;\n    }\n    const nodeValue = {};\n    // convert attributes\n    for (let i = 0; i < node.attributes.length; i++) {\n      const attr = node.attributes[i];\n      if (!isNamespaceAttributeName(attr.nodeName)) {\n        nodeValue[attr.nodeName] = attr.nodeValue;\n      }\n    }\n    // convert child nodes\n    if (node.children.length > 0) {\n      for (let i = 0; i < node.children.length; i++) {\n        const child = node.children[i];\n        const childValue = parseXmlNode(child);\n        if (childValue === undefined) {\n          continue;\n        }\n        const childName = child.nodeName;\n        if (nodeValue[childName] === undefined) {\n          nodeValue[childName] = childValue;\n        } else if (Array.isArray(nodeValue[childName])) {\n          nodeValue[childName].push(childValue);\n        } else {\n          nodeValue[childName] = [nodeValue[childName], childValue];\n        }\n      }\n    }\n    // Return empty element node as empty string instead of `{}`, which is the default behavior of fast-xml-parser.\n    return Object.keys(nodeValue).length === 0 ? '' : nodeValue;\n  }\n};\nconst isElementNode = node => node.nodeType === Node.ELEMENT_NODE;\nconst isDocumentNode = node => node.nodeType === Node.DOCUMENT_NODE;\nconst isTextOnlyElementNode = node => hasOnlyNamespaceAttributes(node) && node.children.length === 0 && node.firstChild?.nodeType === Node.TEXT_NODE;\nconst hasOnlyNamespaceAttributes = node => {\n  for (let i = 0; i < node.attributes.length; i++) {\n    const attr = node.attributes[i];\n    if (!isNamespaceAttributeName(attr.nodeName)) {\n      return false;\n    }\n  }\n  return true;\n};\nconst isNamespaceAttributeName = name => name === 'xmlns' || name.startsWith('xmlns:');\nexport { parser };","map":{"version":3,"names":["parser","parse","xmlStr","domParser","DOMParser","xml","parseFromString","parsedObj","parseXmlNode","rootKey","Object","keys","node","isDocumentNode","documentElement","nodeName","nodeType","Node","TEXT_NODE","nodeValue","trim","isElementNode","isTextOnlyElementNode","childNodes","i","attributes","length","attr","isNamespaceAttributeName","children","child","childValue","undefined","childName","Array","isArray","push","ELEMENT_NODE","DOCUMENT_NODE","hasOnlyNamespaceAttributes","firstChild","name","startsWith"],"sources":["E:\\CSC-PROJECT\\amplify-react-app\\node_modules\\@aws-amplify\\storage\\src\\providers\\s3\\utils\\client\\runtime\\xmlParser\\dom.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Drop-in replacement for fast-xml-parser's XmlParser class used in the AWS SDK S3 client XML deserializer. This\n * implementation is not tested against the full xml conformance test suite. It is only tested against the XML responses\n * from S3. This implementation requires the `DOMParser` class in the runtime.\n */\nexport const parser = {\n    parse: (xmlStr) => {\n        const domParser = new DOMParser();\n        const xml = domParser.parseFromString(xmlStr, 'text/xml');\n        const parsedObj = parseXmlNode(xml);\n        const rootKey = Object.keys(parsedObj)[0];\n        return parsedObj[rootKey];\n    },\n};\nconst parseXmlNode = (node) => {\n    if (isDocumentNode(node)) {\n        return {\n            [node.documentElement.nodeName]: parseXmlNode(node.documentElement),\n        };\n    }\n    if (node.nodeType === Node.TEXT_NODE) {\n        return node.nodeValue?.trim();\n    }\n    if (isElementNode(node)) {\n        // Node like <Location>foo</Location> will be converted to { Location: 'foo' }\n        // instead of { Location: { '#text': 'foo' } }.\n        if (isTextOnlyElementNode(node)) {\n            return node.childNodes[0]?.nodeValue;\n        }\n        const nodeValue = {};\n        // convert attributes\n        for (let i = 0; i < node.attributes.length; i++) {\n            const attr = node.attributes[i];\n            if (!isNamespaceAttributeName(attr.nodeName)) {\n                nodeValue[attr.nodeName] = attr.nodeValue;\n            }\n        }\n        // convert child nodes\n        if (node.children.length > 0) {\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const childValue = parseXmlNode(child);\n                if (childValue === undefined) {\n                    continue;\n                }\n                const childName = child.nodeName;\n                if (nodeValue[childName] === undefined) {\n                    nodeValue[childName] = childValue;\n                }\n                else if (Array.isArray(nodeValue[childName])) {\n                    nodeValue[childName].push(childValue);\n                }\n                else {\n                    nodeValue[childName] = [nodeValue[childName], childValue];\n                }\n            }\n        }\n        // Return empty element node as empty string instead of `{}`, which is the default behavior of fast-xml-parser.\n        return Object.keys(nodeValue).length === 0 ? '' : nodeValue;\n    }\n};\nconst isElementNode = (node) => node.nodeType === Node.ELEMENT_NODE;\nconst isDocumentNode = (node) => node.nodeType === Node.DOCUMENT_NODE;\nconst isTextOnlyElementNode = (node) => hasOnlyNamespaceAttributes(node) &&\n    node.children.length === 0 &&\n    node.firstChild?.nodeType === Node.TEXT_NODE;\nconst hasOnlyNamespaceAttributes = (node) => {\n    for (let i = 0; i < node.attributes.length; i++) {\n        const attr = node.attributes[i];\n        if (!isNamespaceAttributeName(attr.nodeName)) {\n            return false;\n        }\n    }\n    return true;\n};\nconst isNamespaceAttributeName = (name) => name === 'xmlns' || name.startsWith('xmlns:');\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}