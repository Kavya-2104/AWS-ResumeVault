{"ast":null,"code":"import { ConsoleLogger } from '../Logger/ConsoleLogger.mjs';\nimport { KeyValueStorage } from '../storage/KeyValueStorage.mjs';\nimport { getLocalStorageWithFallback } from '../storage/utils.mjs';\nimport { defaultConfig } from './constants.mjs';\nimport { StorageCacheCommon } from './StorageCacheCommon.mjs';\nimport { getCurrentSizeKey, getCurrentTime } from './utils/cacheHelpers.mjs';\nimport './utils/errorHelpers.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst logger = new ConsoleLogger('StorageCache');\n/**\n * Customized storage based on the SessionStorage or LocalStorage with LRU implemented\n */\nclass StorageCache extends StorageCacheCommon {\n  /**\n   * initialize the cache\n   * @param config - the configuration of the cache\n   */\n  constructor(config) {\n    const storage = getLocalStorageWithFallback();\n    super({\n      config,\n      keyValueStorage: new KeyValueStorage(storage)\n    });\n    this.storage = storage;\n    this.getItem = this.getItem.bind(this);\n    this.setItem = this.setItem.bind(this);\n    this.removeItem = this.removeItem.bind(this);\n  }\n  async getAllCacheKeys(options) {\n    const {\n      omitSizeKey\n    } = options ?? {};\n    const keys = [];\n    for (let i = 0; i < this.storage.length; i++) {\n      const key = this.storage.key(i);\n      if (omitSizeKey && key === getCurrentSizeKey(this.config.keyPrefix)) {\n        continue;\n      }\n      if (key?.startsWith(this.config.keyPrefix)) {\n        keys.push(key.substring(this.config.keyPrefix.length));\n      }\n    }\n    return keys;\n  }\n  /**\n   * Return a new instance of cache with customized configuration.\n   * @param {Object} config - the customized configuration\n   * @return {Object} - the new instance of Cache\n   */\n  createInstance(config) {\n    if (!config.keyPrefix || config.keyPrefix === defaultConfig.keyPrefix) {\n      logger.error('invalid keyPrefix, setting keyPrefix with timeStamp');\n      config.keyPrefix = getCurrentTime.toString();\n    }\n    return new StorageCache(config);\n  }\n}\nexport { StorageCache };","map":{"version":3,"names":["logger","ConsoleLogger","StorageCache","StorageCacheCommon","constructor","config","storage","getLocalStorageWithFallback","keyValueStorage","KeyValueStorage","getItem","bind","setItem","removeItem","getAllCacheKeys","options","omitSizeKey","keys","i","length","key","getCurrentSizeKey","keyPrefix","startsWith","push","substring","createInstance","defaultConfig","error","getCurrentTime","toString"],"sources":["E:\\CSC-PROJECT\\amplify-react-app\\node_modules\\@aws-amplify\\core\\src\\Cache\\StorageCache.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { ConsoleLogger } from '../Logger';\nimport { KeyValueStorage } from '../storage/KeyValueStorage';\nimport { getLocalStorageWithFallback } from '../storage/utils';\nimport { defaultConfig } from './constants';\nimport { StorageCacheCommon } from './StorageCacheCommon';\nimport { getCurrentSizeKey, getCurrentTime } from './utils';\nconst logger = new ConsoleLogger('StorageCache');\n/**\n * Customized storage based on the SessionStorage or LocalStorage with LRU implemented\n */\nexport class StorageCache extends StorageCacheCommon {\n    /**\n     * initialize the cache\n     * @param config - the configuration of the cache\n     */\n    constructor(config) {\n        const storage = getLocalStorageWithFallback();\n        super({ config, keyValueStorage: new KeyValueStorage(storage) });\n        this.storage = storage;\n        this.getItem = this.getItem.bind(this);\n        this.setItem = this.setItem.bind(this);\n        this.removeItem = this.removeItem.bind(this);\n    }\n    async getAllCacheKeys(options) {\n        const { omitSizeKey } = options ?? {};\n        const keys = [];\n        for (let i = 0; i < this.storage.length; i++) {\n            const key = this.storage.key(i);\n            if (omitSizeKey && key === getCurrentSizeKey(this.config.keyPrefix)) {\n                continue;\n            }\n            if (key?.startsWith(this.config.keyPrefix)) {\n                keys.push(key.substring(this.config.keyPrefix.length));\n            }\n        }\n        return keys;\n    }\n    /**\n     * Return a new instance of cache with customized configuration.\n     * @param {Object} config - the customized configuration\n     * @return {Object} - the new instance of Cache\n     */\n    createInstance(config) {\n        if (!config.keyPrefix || config.keyPrefix === defaultConfig.keyPrefix) {\n            logger.error('invalid keyPrefix, setting keyPrefix with timeStamp');\n            config.keyPrefix = getCurrentTime.toString();\n        }\n        return new StorageCache(config);\n    }\n}\n"],"mappings":";;;;;;;;AAAA;AACA;AAOA,MAAMA,MAAM,GAAG,IAAIC,aAAa,CAAC,cAAc,CAAC;AAChD;AACA;AACA;AACO,MAAMC,YAAY,SAASC,kBAAkB,CAAC;EACrD;AACA;AACA;AACA;EACIC,WAAWA,CAACC,MAAM,EAAE;IAChB,MAAMC,OAAO,GAAGC,2BAA2B,EAAE;IAC7C,KAAK,CAAC;MAAEF,MAAM;MAAEG,eAAe,EAAE,IAAIC,eAAe,CAACH,OAAO;IAAC,CAAE,CAAC;IAChE,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACI,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,IAAI,CAAC,IAAI,CAAC;IACtC,IAAI,CAACC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACD,IAAI,CAAC,IAAI,CAAC;IACtC,IAAI,CAACE,UAAU,GAAG,IAAI,CAACA,UAAU,CAACF,IAAI,CAAC,IAAI,CAAC;EACpD;EACI,MAAMG,eAAeA,CAACC,OAAO,EAAE;IAC3B,MAAM;MAAEC;IAAW,CAAE,GAAGD,OAAO,IAAI,EAAE;IACrC,MAAME,IAAI,GAAG,EAAE;IACf,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACZ,OAAO,CAACa,MAAM,EAAED,CAAC,EAAE,EAAE;MAC1C,MAAME,GAAG,GAAG,IAAI,CAACd,OAAO,CAACc,GAAG,CAACF,CAAC,CAAC;MAC/B,IAAIF,WAAW,IAAII,GAAG,KAAKC,iBAAiB,CAAC,IAAI,CAAChB,MAAM,CAACiB,SAAS,CAAC,EAAE;QACjE;MAChB;MACY,IAAIF,GAAG,EAAEG,UAAU,CAAC,IAAI,CAAClB,MAAM,CAACiB,SAAS,CAAC,EAAE;QACxCL,IAAI,CAACO,IAAI,CAACJ,GAAG,CAACK,SAAS,CAAC,IAAI,CAACpB,MAAM,CAACiB,SAAS,CAACH,MAAM,CAAC,CAAC;MACtE;IACA;IACQ,OAAOF,IAAI;EACnB;EACA;AACA;AACA;AACA;AACA;EACIS,cAAcA,CAACrB,MAAM,EAAE;IACnB,IAAI,CAACA,MAAM,CAACiB,SAAS,IAAIjB,MAAM,CAACiB,SAAS,KAAKK,aAAa,CAACL,SAAS,EAAE;MACnEtB,MAAM,CAAC4B,KAAK,CAAC,qDAAqD,CAAC;MACnEvB,MAAM,CAACiB,SAAS,GAAGO,cAAc,CAACC,QAAQ,EAAE;IACxD;IACQ,OAAO,IAAI5B,YAAY,CAACG,MAAM,CAAC;EACvC;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}