{"ast":null,"code":"import { signRequest } from '../clients/middleware/signing/signer/signatureV4/signRequest.mjs';\nimport { presignUrl } from '../clients/middleware/signing/signer/signatureV4/presignUrl.mjs';\nimport { TOKEN_QUERY_PARAM } from '../clients/middleware/signing/signer/signatureV4/constants.mjs';\nimport '@aws-crypto/sha256-js';\nimport '@smithy/util-hex-encoding';\nimport { AmplifyUrl } from '../utils/amplifyUrl/index.mjs';\nimport { DateUtils } from './DateUtils.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst IOT_SERVICE_NAME = 'iotdevicegateway';\n// Best practice regex to parse the service and region from an AWS endpoint\nconst AWS_ENDPOINT_REGEX = /([^.]+)\\.(?:([^.]*)\\.)?amazonaws\\.com(.cn)?$/;\n/**\n * This class is intended to be deprecated and replaced by `signRequest` and `presignUrl` functions from\n * `clients/middleware/signing/signer/signatureV4`.\n *\n * TODO: refactor the logics here into `signRequest` and `presignUrl` functions and remove this class.\n *\n * @internal\n * @deprecated\n */\nclass Signer {\n  /**\n  * Sign a HTTP request, add 'Authorization' header to request param\n  * @method sign\n  * @memberof Signer\n  * @static\n  *\n  * @param {object} request - HTTP request object\n  <pre>\n  request: {\n      method: GET | POST | PUT ...\n      url: ...,\n      headers: {\n          header1: ...\n      },\n      data: data\n  }\n  </pre>\n  * @param {object} access_info - AWS access credential info\n  <pre>\n  access_info: {\n      access_key: ...,\n      secret_key: ...,\n      session_token: ...\n  }\n  </pre>\n  * @param {object} [service_info] - AWS service type and region, optional,\n  *                                  if not provided then parse out from url\n  <pre>\n  service_info: {\n      service: ...,\n      region: ...\n  }\n  </pre>\n  *\n  * @returns {object} Signed HTTP request\n  */\n  static sign(request, accessInfo, serviceInfo) {\n    request.headers = request.headers || {};\n    if (request.body && !request.data) {\n      throw new Error('The attribute \"body\" was found on the request object. Please use the attribute \"data\" instead.');\n    }\n    const requestToSign = {\n      ...request,\n      body: request.data,\n      url: new AmplifyUrl(request.url)\n    };\n    const options = getOptions(requestToSign, accessInfo, serviceInfo);\n    const signedRequest = signRequest(requestToSign, options);\n    // Prior to using `signRequest`, Signer accepted urls as strings and outputted urls as string. Coerce the property\n    // back to a string so as not to disrupt consumers of Signer.\n    signedRequest.url = signedRequest.url.toString();\n    // HTTP headers should be case insensitive but, to maintain parity with the previous Signer implementation and\n    // limit the impact of this implementation swap, replace lowercased headers with title cased ones.\n    signedRequest.headers.Authorization = signedRequest.headers.authorization;\n    signedRequest.headers['X-Amz-Security-Token'] = signedRequest.headers['x-amz-security-token'];\n    delete signedRequest.headers.authorization;\n    delete signedRequest.headers['x-amz-security-token'];\n    return signedRequest;\n  }\n  static signUrl(urlOrRequest, accessInfo, serviceInfo, expiration) {\n    const urlToSign = typeof urlOrRequest === 'object' ? urlOrRequest.url : urlOrRequest;\n    const method = typeof urlOrRequest === 'object' ? urlOrRequest.method : 'GET';\n    const body = typeof urlOrRequest === 'object' ? urlOrRequest.body : undefined;\n    const presignable = {\n      body,\n      method,\n      url: new AmplifyUrl(urlToSign)\n    };\n    const options = getOptions(presignable, accessInfo, serviceInfo, expiration);\n    const signedUrl = presignUrl(presignable, options);\n    if (accessInfo.session_token && !sessionTokenRequiredInSigning(options.signingService)) {\n      signedUrl.searchParams.append(TOKEN_QUERY_PARAM, accessInfo.session_token);\n    }\n    return signedUrl.toString();\n  }\n}\nconst getOptions = (request, accessInfo, serviceInfo, expiration) => {\n  const {\n    access_key,\n    secret_key,\n    session_token\n  } = accessInfo ?? {};\n  const {\n    region: urlRegion,\n    service: urlService\n  } = parseServiceInfo(request.url);\n  const {\n    region = urlRegion,\n    service = urlService\n  } = serviceInfo ?? {};\n  const credentials = {\n    accessKeyId: access_key,\n    secretAccessKey: secret_key,\n    ...(sessionTokenRequiredInSigning(service) ? {\n      sessionToken: session_token\n    } : {})\n  };\n  return {\n    credentials,\n    signingDate: DateUtils.getDateWithClockOffset(),\n    signingRegion: region,\n    signingService: service,\n    ...(expiration && {\n      expiration\n    })\n  };\n};\nconst parseServiceInfo = url => {\n  const {\n    host\n  } = url;\n  const matched = host.match(AWS_ENDPOINT_REGEX) ?? [];\n  let parsed = matched.slice(1, 3);\n  if (parsed[1] === 'es') {\n    // Elastic Search\n    parsed = parsed.reverse();\n  }\n  return {\n    service: parsed[0],\n    region: parsed[1]\n  };\n};\n// IoT service does not allow the session token in the canonical request\n// https://docs.aws.amazon.com/general/latest/gr/sigv4-add-signature-to-request.html\nconst sessionTokenRequiredInSigning = service => service !== IOT_SERVICE_NAME;\nexport { Signer };","map":{"version":3,"names":["IOT_SERVICE_NAME","AWS_ENDPOINT_REGEX","Signer","sign","request","accessInfo","serviceInfo","headers","body","data","Error","requestToSign","url","AmplifyUrl","options","getOptions","signedRequest","signRequest","toString","Authorization","authorization","signUrl","urlOrRequest","expiration","urlToSign","method","undefined","presignable","signedUrl","presignUrl","session_token","sessionTokenRequiredInSigning","signingService","searchParams","append","TOKEN_QUERY_PARAM","access_key","secret_key","region","urlRegion","service","urlService","parseServiceInfo","credentials","accessKeyId","secretAccessKey","sessionToken","signingDate","DateUtils","getDateWithClockOffset","signingRegion","host","matched","match","parsed","slice","reverse"],"sources":["E:\\CSC-PROJECT\\amplify-react-app\\node_modules\\@aws-amplify\\core\\src\\Signer\\Signer.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { TOKEN_QUERY_PARAM, presignUrl, signRequest, } from '../clients/middleware/signing/signer/signatureV4';\nimport { AmplifyUrl } from '../utils/amplifyUrl';\nimport { DateUtils } from './DateUtils';\nconst IOT_SERVICE_NAME = 'iotdevicegateway';\n// Best practice regex to parse the service and region from an AWS endpoint\nconst AWS_ENDPOINT_REGEX = /([^.]+)\\.(?:([^.]*)\\.)?amazonaws\\.com(.cn)?$/;\n/**\n * This class is intended to be deprecated and replaced by `signRequest` and `presignUrl` functions from\n * `clients/middleware/signing/signer/signatureV4`.\n *\n * TODO: refactor the logics here into `signRequest` and `presignUrl` functions and remove this class.\n *\n * @internal\n * @deprecated\n */\nexport class Signer {\n    /**\n    * Sign a HTTP request, add 'Authorization' header to request param\n    * @method sign\n    * @memberof Signer\n    * @static\n    *\n    * @param {object} request - HTTP request object\n    <pre>\n    request: {\n        method: GET | POST | PUT ...\n        url: ...,\n        headers: {\n            header1: ...\n        },\n        data: data\n    }\n    </pre>\n    * @param {object} access_info - AWS access credential info\n    <pre>\n    access_info: {\n        access_key: ...,\n        secret_key: ...,\n        session_token: ...\n    }\n    </pre>\n    * @param {object} [service_info] - AWS service type and region, optional,\n    *                                  if not provided then parse out from url\n    <pre>\n    service_info: {\n        service: ...,\n        region: ...\n    }\n    </pre>\n    *\n    * @returns {object} Signed HTTP request\n    */\n    static sign(request, accessInfo, serviceInfo) {\n        request.headers = request.headers || {};\n        if (request.body && !request.data) {\n            throw new Error('The attribute \"body\" was found on the request object. Please use the attribute \"data\" instead.');\n        }\n        const requestToSign = {\n            ...request,\n            body: request.data,\n            url: new AmplifyUrl(request.url),\n        };\n        const options = getOptions(requestToSign, accessInfo, serviceInfo);\n        const signedRequest = signRequest(requestToSign, options);\n        // Prior to using `signRequest`, Signer accepted urls as strings and outputted urls as string. Coerce the property\n        // back to a string so as not to disrupt consumers of Signer.\n        signedRequest.url = signedRequest.url.toString();\n        // HTTP headers should be case insensitive but, to maintain parity with the previous Signer implementation and\n        // limit the impact of this implementation swap, replace lowercased headers with title cased ones.\n        signedRequest.headers.Authorization = signedRequest.headers.authorization;\n        signedRequest.headers['X-Amz-Security-Token'] =\n            signedRequest.headers['x-amz-security-token'];\n        delete signedRequest.headers.authorization;\n        delete signedRequest.headers['x-amz-security-token'];\n        return signedRequest;\n    }\n    static signUrl(urlOrRequest, accessInfo, serviceInfo, expiration) {\n        const urlToSign = typeof urlOrRequest === 'object' ? urlOrRequest.url : urlOrRequest;\n        const method = typeof urlOrRequest === 'object' ? urlOrRequest.method : 'GET';\n        const body = typeof urlOrRequest === 'object' ? urlOrRequest.body : undefined;\n        const presignable = {\n            body,\n            method,\n            url: new AmplifyUrl(urlToSign),\n        };\n        const options = getOptions(presignable, accessInfo, serviceInfo, expiration);\n        const signedUrl = presignUrl(presignable, options);\n        if (accessInfo.session_token &&\n            !sessionTokenRequiredInSigning(options.signingService)) {\n            signedUrl.searchParams.append(TOKEN_QUERY_PARAM, accessInfo.session_token);\n        }\n        return signedUrl.toString();\n    }\n}\nconst getOptions = (request, accessInfo, serviceInfo, expiration) => {\n    const { access_key, secret_key, session_token } = accessInfo ?? {};\n    const { region: urlRegion, service: urlService } = parseServiceInfo(request.url);\n    const { region = urlRegion, service = urlService } = serviceInfo ?? {};\n    const credentials = {\n        accessKeyId: access_key,\n        secretAccessKey: secret_key,\n        ...(sessionTokenRequiredInSigning(service)\n            ? { sessionToken: session_token }\n            : {}),\n    };\n    return {\n        credentials,\n        signingDate: DateUtils.getDateWithClockOffset(),\n        signingRegion: region,\n        signingService: service,\n        ...(expiration && { expiration }),\n    };\n};\nconst parseServiceInfo = (url) => {\n    const { host } = url;\n    const matched = host.match(AWS_ENDPOINT_REGEX) ?? [];\n    let parsed = matched.slice(1, 3);\n    if (parsed[1] === 'es') {\n        // Elastic Search\n        parsed = parsed.reverse();\n    }\n    return {\n        service: parsed[0],\n        region: parsed[1],\n    };\n};\n// IoT service does not allow the session token in the canonical request\n// https://docs.aws.amazon.com/general/latest/gr/sigv4-add-signature-to-request.html\nconst sessionTokenRequiredInSigning = (service) => service !== IOT_SERVICE_NAME;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}